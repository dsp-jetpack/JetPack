# By default all passwords are generated when using erb passwd_auto stanza
# Replacing passwd_auto content by a string will make it the same everywhere
# Alternatively static values can be used directly
<%  require 'facter'
    require 'securerandom'

    if Facter.version  =~ /2.*/
      mail_auto = "admin@#{Facter.value('domain')}"
    else
      mail_auto = "admin@#{Facter.domain}"
    end

    ### Variables to change
    ##

    passwd_auto = 'cr0wBar!'
  

    cluster_member_ip1 = '192.168.131.112'
    cluster_member_name1 = 'controller01'

    cluster_member_ip2 = '192.168.131.113'
    cluster_member_name2 = 'controller02'

    cluster_member_ip3 = '192.168.131.114'
    cluster_member_name3 = 'controller03'
    
    cluster_admin_host = cluster_member_ip1


    ## VIPs
    vip_amqp = '192.168.131.141'

    vip_cinder_adm = '192.168.131.130'
    vip_cinder_priv = vip_cinder_adm
    vip_cinder_pub = '10.21.148.119'

    vip_db = '192.168.131.131'

    vip_glance_adm = '192.168.131.132'
    vip_glance_priv = vip_glance_adm
    vip_glance_pub = '10.21.148.120'

    vip_heat_adm = '192.168.131.133'
    vip_heat_priv = vip_heat_adm
    vip_heat_pub = '10.21.148.121'

    vip_heat_cfn_adm = '192.168.131.134'
    vip_heat_cfn_priv = vip_heat_cfn_adm
    vip_heat_cfn_pub = '10.21.148.122'

    vip_horizon_adm = '192.168.131.135'
    vip_horizon_priv = vip_horizon_adm
    vip_horizon_pub = '10.21.148.123'

    vip_keystone_adm = '192.168.131.136'
    vip_keystone_priv = vip_keystone_adm
    vip_keystone_pub = '10.21.148.124'

    vip_loadbalancer = '192.168.131.140'

    vip_nova_adm = '192.168.131.137'
    vip_nova_priv = '192.168.131.138'
    vip_nova_pub = '10.21.148.125'





    # auto assign ips to VMs.
    auto_float_ip = false

    vbose = 'false'
    dbug = 'false'

    c_be_eqlx = false
    c_be_eqlx_name = [ "eqlx_backend" ]
    c_be_rbd = 'false'
    c_be_rbd_name = 'rbd_backend'
    c_eqlx_ch_login = [ "chapadmin"]
    c_eqlx_ch_pass = [ '""' ]
    c_eqlx_group_n = [ "group-0"]
    c_eqlx_pool = [ "default" ]
    c_eqlx_use_chap = [ "false" ]
    c_mult_be = 'false'
    c_rbd_pool = 'volumes'
    c_rbd_user = 'volumes'
    
    fence_ipmi_ip = ''
    fence_ipmi_lanplus = 'true'
    fence_ipmi_user = 'root'
    fence_type = 'fence_ipmilan'

    # Interface for cluster communications - Private API
    fence_clu_iface = '192.168.131.139'
    
    glance_be = 'file'
    rbd_spool = 'images'
    rbd_suser = 'images'

    def_float_pool = 'nova'

    heat_cfn_en = 'true'
    heat_cloudw_en = 'true'

    inc_cinder = 'true'
    inc_heat = 'true'


    # amqp_provider
    amqp_pro = 'rabbitmq'

    # network_create_networks
    net_create = true

    # network_fixed_range - nova private network
    net_fix = '192.168.135.0/24'

    # network_floating_range - nova public network
    net_float = '192.168.132.0/24'

    # network_manager, network_network_size, network_num_networks
    net_man = 'VlanManager'
    net_size = 256
    net_num = 1

    # network_private_iface - nova private interface (em2 or bond0.300, etc...)
    net_priv_iface = 'bond0.131'

    # network_public_iface - nova public interface (em3 or bond0.301, etc...)
    net_pub_iface = 'bond1'

    keystnrc = 'true'

    ##
    ### End of Variables to change



%>
---
####  Variables below this line should not need to be changed.
##

keystonerc: <%= keystnrc %>

backend_eqlx: <%= c_be_eqlx %>
backend_eqlx_name:
<% c_be_eqlx_name.each do |name| %>
- <%= name %>
<% end %>

backend_rbd: <%= c_be_rbd %>
backend_rbd_name: <%= c_be_rbd_name %>
debug: <%= dbug %>
eqlx_chap_login:
<% c_eqlx_ch_login.each do |name| %>
- <%= name %>
<% end %>

eqlx_chap_password: 
<% c_eqlx_ch_pass.each do |name| %>
- <%= name %>
<% end %>

eqlx_group_name:
<% c_eqlx_group_n.each do |name| %>
- <%= name %>
<% end %>

eqlx_pool:
<% c_eqlx_pool.each do |name| %>
- <%= name %>
<% end %>

eqlx_use_chap:
<% c_eqlx_use_chap.each do |name| %>
- <%= name %>
<% end %>

multiple_backends: <%= c_mult_be %>
rbd_pool: <%= c_rbd_pool %>
rbd_secret_uuid: <%= passwd_auto %>
rbd_user: <%= c_rbd_user %>
verbose: <%= vbose %>

fence_ipmilan_address: <%= fence_ipmi_ip %>
fence_ipmilan_expose_lanplus: <%= fence_ipmi_lanplus %>
fence_ipmilan_password: <%= passwd_auto %>
fence_ipmilan_username: <%= fence_ipmi_user %>
fence_xvm_key_file_password: <%= passwd_auto %>
fence_xvm_clu_iface: <%= fence_clu_iface %>
fencing_type: <%= fence_type %>
pacemaker_cluster_members: <%= cluster_member_ip1 %> <%= cluster_member_ip2 %> <%= cluster_member_ip3 %>

galera_monitor_password: <%= passwd_auto %>
mysql_root_password: <%= passwd_auto %>
wsrep_cluster_members:
- <%= cluster_member_ip1 %>
- <%= cluster_member_ip2 %>
- <%= cluster_member_ip3 %>
wsrep_sst_password: <%= passwd_auto %>

backend: <%= glance_be %>
rbd_store_pool: <%= rbd_spool %>
rbd_store_user: <%= rbd_suser %>

secret_key: <%= passwd_auto %>
verbose: <%= vbose %>

admin_password: <%= passwd_auto %>

#  quickstack::pacemaker::neutron:
#   ++++ enabled: false
#   = ovs_bridge_mappings:
#    = ovs_bridge_uplinks:
#    - br-p3p1:p3p1
#    - br-em3:em3
#    = ovs_vlan_ranges: physint:1000:1020,physext

default_floating_pool: <%= def_float_pool %>
neutron_metadata_proxy_secret: <%= passwd_auto %>

amqp_password: <%= passwd_auto %>
amqp_vip: <%= vip_amqp %>

#    =check with keith = ceph_cluster_network: ''

cinder_admin_vip: <%= vip_cinder_adm %>
cinder_db_password: <%= passwd_auto %>
cinder_private_vip: <%= vip_cinder_priv %>
cinder_public_vip: <%= vip_cinder_pub %>
cinder_user_password: <%= passwd_auto %>
cluster_control_ip: <%= cluster_admin_host %>
db_vip: <%= vip_db %>
glance_admin_vip: <%= vip_glance_adm %>
glance_db_password: <%= passwd_auto %>
glance_private_vip: <%= vip_glance_priv %>
glance_public_vip: <%= vip_glance_pub %>
glance_user_password: <%= passwd_auto %>
heat_admin_vip: <%= vip_heat_adm %>
heat_auth_encryption_key: <%= passwd_auto %>
heat_cfn_admin_vip: <%= vip_heat_cfn_adm %>
heat_cfn_enabled: <%= heat_cfn_en %>
heat_cfn_private_vip: <%= vip_heat_cfn_priv %>
heat_cfn_public_vip: <%= vip_heat_cfn_pub %>
heat_cfn_user_password: <%= passwd_auto %>
heat_cloudwatch_enabled: <%= heat_cloudw_en %>
heat_db_password: <%= passwd_auto %>
heat_private_vip: <%= vip_heat_priv %>
heat_public_vip: <%= vip_heat_pub %>
heat_user_password: <%= passwd_auto %>
horizon_admin_vip: <%= vip_horizon_adm %>
horizon_private_vip: <%= vip_horizon_priv %>
horizon_public_vip: <%= vip_horizon_pub %>
include_cinder: <%= inc_cinder %>
include_heat: <%= inc_heat %>
include_neutron: false
include_swift: false
keystone_admin_vip: <%= vip_keystone_adm %>
keystone_db_password: <%= passwd_auto %>
keystone_private_vip: <%= vip_keystone_priv %>
keystone_public_vip: <%= vip_keystone_pub %>
keystone_user_password: <%= passwd_auto %>
lb_backend_server_addrs:
- <%= cluster_member_ip1 %>
- <%= cluster_member_ip2 %>
- <%= cluster_member_ip3 %>
lb_backend_server_names:
- <%= cluster_member_name1 %>
- <%= cluster_member_name2 %>
- <%= cluster_member_name3 %>
loadbalancer_vip: <%= vip_loadbalancer %>
neutron: false
nova_admin_vip: <%= vip_nova_adm %>
nova_db_password: <%= passwd_auto %>
nova_private_vip: <%= vip_nova_priv %>
nova_public_vip: <%= vip_nova_pub %>
nova_user_password: <%= passwd_auto %>
private_ip: 127.0.0.1



#########################################


amqp_host: <%= vip_amqp %>
amqp_port: '5672'
amqp_provider: <%= amqp_pro %>
amqp_ssl_port: '5671'
amqp_username: openstack
auth_host: <%= vip_keystone_adm %>
auto_assign_floating_ip: <%= auto_float_ip %>
ceilometer: false
ceph_cluster_network: ''
ceph_fsid: ''
ceph_images_key: ''
ceph_mon_host: []
ceph_mon_initial_members: []
ceph_public_network: ''
ceph_volumes_key: ''
cinder_backend_gluster: false
cinder_backend_nfs: false
cinder_backend_rbd: 'false'
glance_backend_rbd: 'false'
glance_host: <%= vip_glance_adm %>
libvirt_images_rbd_ceph_conf: /etc/ceph/ceph.conf
libvirt_images_rbd_pool: volumes
libvirt_images_type: rbd
libvirt_inject_key: 'false'
libvirt_inject_password: 'false'
mysql_ca: /etc/ipa/ca.crt
mysql_host: <%= vip_db %>
network_create_networks: <%= net_create %>
network_fixed_range: <%= net_fix %>
network_floating_range: <%= net_float %>
network_manager: <%= net_man %>
network_network_size: <%= net_size %>
network_num_networks: <%= net_num %>
network_overrides:
  vlan_start: 900
  force_dhcp_release: 'false'
network_private_iface: <%= net_priv_iface %>
network_private_network: ''
network_public_iface: <%= net_pub_iface %>
network_public_network: ''
nova_db_password: <%= passwd_auto %>
nova_host: <%= vip_nova_adm %>
nova_multi_host: 'True'
nova_user_password: <%= passwd_auto %>


