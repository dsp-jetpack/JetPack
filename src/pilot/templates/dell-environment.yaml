# (c) 2016 Dell
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

resource_registry:
    OS::TripleO::NodeUserData: HOME/pilot/templates/first-boot.yaml
    OS::TripleO::NodeExtraConfigPost: HOME/pilot/templates/post-deploy.yaml

parameter_defaults:
  # Set to true to enable Nova usage of Ceph for ephemeral storage.
  # If set to false, Nova uses the storage local to the compute.
  NovaEnableRbdBackend: true

  # Set false in order to use use Ceph radosgw for object storage.
  ControllerEnableSwiftStorage: false

  # Additional hiera data for all nodes
  # Override ceph_pools so the .rgw.buckets pool is created during deployment.
  # Place this in ExtraConfig rather than CephStorageExtraConfig so the list
  # of default pools is available on all nodes.
  ExtraConfig:
    ceph_pools: [
      "volumes",
      "vms",
      "images",
      ".rgw.buckets"
    ]

  # Additional hiera data for storage nodes
  CephStorageExtraConfig:
    # Additional entries added to /etc/ceph/ceph.conf
    ceph_tuning:
      max_open_files: 131072

  # Additional hiera data for controller nodes
  controllerExtraConfig:
    swift::service::enabled: false
    ceph::profile::params::enable_rgw: true
    ceph::profile::params::rgw_frontends: "civetweb port=7480"
    # Additional entries added to /etc/ceph/ceph.conf
    ceph_tuning:
      rgw_keystone_url: RGW_KEYSTONE_URL
      rgw_keystone_admin_token: RGW_KEYSTONE_ADMIN_TOKEN
      rgw_keystone_accepted_roles: "_member_, Member, admin, swift"
      rgw_keystone_token_cache size: 500
      rgw_keystone_revocation_interval: 600
      rgw_keystone_make_new_tenants: true
      rgw_s3_auth_use_keystone: true
