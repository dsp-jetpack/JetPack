From c3707bbf60495a184a49c6cb741b94c8535dc2ff Mon Sep 17 00:00:00 2001
From: Matthias Runge <mrunge@redhat.com>
Date: Wed, 8 Jul 2015 16:04:03 +0200
Subject: [PATCH 1/5] Add projects switcher, region switcher to RCUE

Resolves: rhbz#1240895

Change-Id: I98ecc48ae67f73dc5f7f0a7490d450796e8e3f8d
---
 .../dashboards/theme/templates/_header.html          | 15 ++++++++++++++-
 .../templates/context_selection/_domain_list.html    | 10 ++++++++++
 .../theme/templates/context_selection/_overview.html | 13 +++++++++++++
 .../templates/context_selection/_project_list.html   | 18 ++++++++++++++++++
 .../templates/context_selection/_region_list.html    | 20 ++++++++++++++++++++
 5 files changed, 75 insertions(+), 1 deletion(-)
 create mode 100644 openstack_dashboard/dashboards/theme/templates/context_selection/_domain_list.html
 create mode 100644 openstack_dashboard/dashboards/theme/templates/context_selection/_overview.html
 create mode 100644 openstack_dashboard/dashboards/theme/templates/context_selection/_project_list.html
 create mode 100644 openstack_dashboard/dashboards/theme/templates/context_selection/_region_list.html

diff --git a/openstack_dashboard/dashboards/theme/templates/_header.html b/openstack_dashboard/dashboards/theme/templates/_header.html
index 482d3e8..7b35815 100644
--- a/openstack_dashboard/dashboards/theme/templates/_header.html
+++ b/openstack_dashboard/dashboards/theme/templates/_header.html
@@ -1,6 +1,19 @@
+{% load horizon %}
 {% load i18n %}
-{% load url from future %}
+{% load context_selection %}
 <ul class="nav pull-right" id="user_info">
+  <li class="dropdown " >
+  <a href="#" class="dropdown-toggle"><span class="rcueicon rcueicon-list"></span>{% trans "Project" %}{{ project_name }}<b class="caret"></b></a>
+  <ul class="dropdown-menu">
+  {% if domain_supported %}
+  {% show_domain_list %}
+  {% endif %}
+  {% show_project_list %}
+  {% if multi_region %}
+  {% show_region_list %}
+  {% endif %}
+  </ul>
+  </li>
   {% url 'horizon:redhat_access_plugin_openstack:search:index' as plugin_url %}
   {% if plugin_url %}
     <li class="dropdown {% if request.horizon.dashboard.slug == "redhat_access_plugin_openstack" %}active{% endif %}">
diff --git a/openstack_dashboard/dashboards/theme/templates/context_selection/_domain_list.html b/openstack_dashboard/dashboards/theme/templates/context_selection/_domain_list.html
new file mode 100644
index 0000000..81e1c52
--- /dev/null
+++ b/openstack_dashboard/dashboards/theme/templates/context_selection/_domain_list.html
@@ -0,0 +1,10 @@
+{% load i18n %}
+{% if domain_supported %}
+  <li class="dropdown-header">{% trans "Domains:" %}</li>
+  <li>
+    <a class="disabled">
+      {{ domain_name }}
+      <span class="fa fa-check"></span>
+    </a>
+  </li>
+{% endif %}
diff --git a/openstack_dashboard/dashboards/theme/templates/context_selection/_overview.html b/openstack_dashboard/dashboards/theme/templates/context_selection/_overview.html
new file mode 100644
index 0000000..ba217aa
--- /dev/null
+++ b/openstack_dashboard/dashboards/theme/templates/context_selection/_overview.html
@@ -0,0 +1,13 @@
+<li class="dropdown">
+<ul class="dropdown-menu">
+    {% if domain_supported %}
+    <li>{{ domain_name }}</li>
+    <li>&middot;</li>
+    {% endif %}
+    <li>{{ project_name }}</li>
+    {% if multi_region %}
+    <strong>&middot;</strong>
+    <span>{{ region_name }}</span>
+    {% endif %}
+  </ul>
+</li>
diff --git a/openstack_dashboard/dashboards/theme/templates/context_selection/_project_list.html b/openstack_dashboard/dashboards/theme/templates/context_selection/_project_list.html
new file mode 100644
index 0000000..88db57d
--- /dev/null
+++ b/openstack_dashboard/dashboards/theme/templates/context_selection/_project_list.html
@@ -0,0 +1,18 @@
+{% load i18n %}
+
+{% with dashboard_url=request.horizon.dashboard.get_absolute_url %}
+<li class="dropdown-header">{% trans "Projects:" %}
+  <ul>
+  {% for project in projects %}
+  <li>
+    <a href="{% url 'switch_tenants' project.id %}?next={{ dashboard_url }}">
+      {{ project.name }}
+      {% if project.enabled and project.id == project_id %}
+      <span class="fa fa-check"></span>
+      {% endif %}
+    </a>
+  </li>
+  {% endfor %}
+  </ul>
+</li>
+{% endwith %}
diff --git a/openstack_dashboard/dashboards/theme/templates/context_selection/_region_list.html b/openstack_dashboard/dashboards/theme/templates/context_selection/_region_list.html
new file mode 100644
index 0000000..b3bfed9
--- /dev/null
+++ b/openstack_dashboard/dashboards/theme/templates/context_selection/_region_list.html
@@ -0,0 +1,20 @@
+{% load i18n %}
+
+{% if multi_region %}
+{% with panel_url=request.horizon.panel.get_absolute_url %}
+<li class="dropdown-header">{% trans "Regions:" %}</li>
+  <ul>
+  {% for region in regions %}
+  <li>
+    <a href="{% url 'switch_services_region' region %}?next={{ panel_url }}">
+      {{ region }}
+      {% if region == region_name %}
+      <span class="fa fa-check"></span>
+      {% endif %}
+    </a>
+  </li>
+  {% endfor %}
+  </ul>
+</li>
+{% endwith %}
+{% endif %}
-- 
2.4.3

